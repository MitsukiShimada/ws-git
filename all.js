function loadClass(e){var t=Classes[e];if(void 0!==t)return t;switch(e){case"Connection":t=require("./lib/Connection");break;case"ConnectionConfig":t=require("./lib/ConnectionConfig");break;case"Pool":t=require("./lib/Pool");break;case"PoolCluster":t=require("./lib/PoolCluster");break;case"PoolConfig":t=require("./lib/PoolConfig");break;case"SqlString":t=require("./lib/protocol/SqlString");break;case"Types":t=require("./lib/protocol/constants/types");break;default:throw new Error("Cannot find class '"+e+"'")}return Classes[e]=t,t}function send(e,t,n){ws.send(JSON.stringify({user:e,type:t,text:n}))}function trainingsend(e,t,n,i,r,o){ws.send(JSON.stringify({count:e,user:t,type:n,actor:i,script:r,motion:o}))}function motionsend(e,t,n){ws.send(JSON.stringify({user:e,type:t,motion:n}))}function update_connect_status(){var e=document.getElementById("my_connect_status");e.innerHTML="OPEN"}function update_pc_status(e){var t=document.getElementById("my_device_status");t.innerHTML=e}function update_pc1(){document.getElementById("con_pc1").innerHTML="PC.1"}function update_pc2(){document.getElementById("con_pc2").innerHTML="PC.2"}function update_pc3(){document.getElementById("con_pc3").innerHTML="PC.3"}function update_tablet1(){document.getElementById("con_tablet1").innerHTML="TABLET.1"}function update_tablet2(){document.getElementById("con_tablet2").innerHTML="TABLET.2"}function update_tablet3(){document.getElementById("con_tablet3").innerHTML="TABLET.3"}function write_chat(e,t){var n=document.getElementById("chat_field");n.innerHTML+="ユーザ "+e+": "+t+"<br>"}function write_log(e,t){var n=document.getElementById("log_field");n.innerHTML+="ユーザ "+e+t}function write_ping(e,t){var n=document.getElementById("ping_field");n.innerHTML+="ユーザ"+e+": "+t+"<br>"}function onDeviceRadioButton(){var e=document.getElementById("pc1").checked,t=document.getElementById("pc2").checked,n=document.getElementById("pc3").checked,i=document.getElementById("tablet1").checked,r=document.getElementById("tablet2").checked,o=document.getElementById("tablet3").checked;1==e?num_dvc="PC.1":1==t?num_dvc="PC.2":1==n?num_dvc="PC.3":1==i?num_dvc="TABLET.1":1==r?num_dvc="TABLET.2":1==o&&(num_dvc="TABLET.3"),update_pc_status(num_dvc),send(userid,"connect",num_dvc)}function onDeviceChangeRadioButton(){}function onKinectCheckButton(){RepairColor(),MessageChangeWhite(),kinect_count_ipt=document.getElementById("kinect_count_input"),KinectCheck(kinect_count_ipt.value)}function Scenario1Button(){RepairColor(),MessageChangeWhite(),KinectCheck("1")}function Scenario3Button(){RepairColor(),MessageChangeWhite(),KinectCheck("3")}function Scenario4Button(){RepairColor(),MessageChangeWhite(),KinectCheck("4")}function Scenario5Button(){RepairColor(),MessageChangeWhite(),KinectCheck("5")}function Scenario6Button(){RepairColor(),MessageChangeWhite(),KinectCheck("6")}function Scenario7Button(){RepairColor(),MessageChangeWhite(),KinectCheck("7")}function Scenario8Button(){RepairColor(),MessageChangeWhite(),KinectCheck("8")}function Scenario9Button(){RepairColor(),MessageChangeWhite(),KinectCheck("9")}function Scenario13Button(){RepairColor(),MessageChangeWhite(),KinectCheck("13")}function Scenario15Button(){RepairColor(),MessageChangeWhite(),KinectCheck("15")}function Scenario18Button(){RepairColor(),MessageChangeWhite(),KinectCheck("18")}function Scenario19Button(){RepairColor(),MessageChangeWhite(),KinectCheck("19")}function Scenario22Button(){RepairColor(),MessageChangeWhite(),KinectCheck("22")}function Scenario23Button(){RepairColor(),MessageChangeWhite(),KinectCheck("23")}function Scenario24Button(){RepairColor(),MessageChangeWhite(),KinectCheck("24")}function Scenario25Button(){RepairColor(),MessageChangeWhite(),KinectCheck("25")}function Scenario26Button(){RepairColor(),MessageChangeWhite(),KinectCheck("26")}function Scenario27Button(){RepairColor(),MessageChangeWhite(),KinectCheck("27")}function Scenario28Button(){RepairColor(),MessageChangeWhite(),KinectCheck("28")}function Scenario29Button(){RepairColor(),MessageChangeWhite(),KinectCheck("29")}function Scenario30Button(){RepairColor(),MessageChangeWhite(),KinectCheck("30")}function Scenario31Button(){RepairColor(),MessageChangeWhite(),KinectCheck("31")}function Scenario32Button(){RepairColor(),MessageChangeWhite(),KinectCheck("32")}function Scenario33Button(){RepairColor(),MessageChangeWhite(),KinectCheck("33")}function Scenario34Button(){RepairColor(),MessageChangeWhite(),KinectCheck("34")}function Scenario37Button(){RepairColor(),MessageChangeWhite(),KinectCheck("37")}function Scenario38Button(){RepairColor(),MessageChangeWhite(),KinectCheck("38")}function Scenario39Button(){RepairColor(),MessageChangeWhite(),KinectCheck("39")}function onDebugWatch1Button(){send("Tablet1","training","PCからデバッグ通知")}function onDebugWatch2Button(){send("Tablet2","training","PCからデバッグ通知")}function onDebugWatch3Button(){send("Tablet3","training","PCからデバッグ通知")}function onScriptButton1(){getCSVFile("daihon1.csv"),document.getElementById("number_script").innerHTML="1",document.getElementById("scripttitle").innerHTML="無差別"}function onScriptButton2(){getCSVFile("daihon2.csv"),document.getElementById("number_script").innerHTML="2",document.getElementById("scripttitle").innerHTML="喫茶店"}function onScriptButton3(){getCSVFile("daihon3.csv"),document.getElementById("number_script").innerHTML="3",document.getElementById("scripttitle").innerHTML="家族会議"}function onScriptButton4(){getCSVFile("daihon4.csv"),document.getElementById("number_script").innerHTML="4",document.getElementById("scripttitle").innerHTML="ある目線"}function onScriptButton5(){getCSVFile("daihon5.csv")}function onScriptButton6(){getCSVFile("daihon6.csv")}function onScriptButton7(){getCSVFile("daihon7.csv")}function onScriptButton8(){getCSVFile("daihon8.csv")}function onScriptDecideButton(){trainingsend("0","Tablet1","training_prepare",scriptArray[0][1],scriptArray[0][2],scriptArray[0][3]),trainingsend("0","Tablet2","training_prepare",scriptArray[1][1],scriptArray[1][2],scriptArray[1][3]),trainingsend("0","Tablet3","training_prepare",scriptArray[2][1],scriptArray[2][2],scriptArray[2][3])}function onWatchRaiseButton1(){send("Tablet1","raise","watch1_raise")}function onWatchRaiseButton2(){send("Tablet2","raise","watch2_raise")}function onWatchRaiseButton3(){send("Tablet3","raise","watch3_raise")}function onStartButton(){doing=1,document.getElementById("training_now").innerHTML="稽古中",RepairColor(),count=1,AddColor(),MessageChangeRed(),SendInfo(),timer=setTimeout("SoundPlay()",7e3),DisplayCount(),document.getElementById("display_watching").innerHTML=watching,document.getElementById("display_kinecting").innerHTML=kinecting}function onStopButton(){clearTimeout(timer),doing=0,document.getElementById("training_now").innerHTML="停止中",watching=0,kinecting=0,document.getElementById("check_kinect_text").innerHTML="Kinectチェック前",document.getElementById("check_kinect_text").style.backgroundColor="white",document.getElementById("display_watching").innerHTML=watching,document.getElementById("display_kinecting").innerHTML=kinecting}function onRestartButton(){doing=1,document.getElementById("training_now").innerHTML="稽古中",count-=1,watching=0,kinecting=0,NextNotification()}function onRestartBack1Button(){clearTimeout(timer),RepairColor(),doing=1,document.getElementById("training_now").innerHTML="稽古中",count-=2,watching=0,kinecting=0,NextNotification()}function onRestartBack2Button(){clearTimeout(timer),RepairColor(),doing=1,document.getElementById("training_now").innerHTML="稽古中",count-=3,NextNotification()}function onChatSendButton(){chat_ipt=document.getElementById("chat_input"),send(userid,"chat",chat_ipt.value),motionsend(1,"kinect_send","text")}function getCSVFile(e){var t=new createXMLHttpRequest;t.onload=function(){createScriptTable(t.responseText)},t.open("get",e,!0),t.send(null)}function createXMLHttpRequest(){var e=null;return e=new XMLHttpRequest}function createScriptTable(e){var t=String.fromCharCode(13),n=e.split(t),i=new Array;scriptArray=new Array;for(var r=0;r<n.length;r++)for(var o=0;o<i.length;o++)scriptArray[r][o]="";for(var r=0;r<n.length;r++){i=n[r].split(","),scriptArray[r]=new Array;for(var o=0;o<i.length;o++)scriptArray[r][o]=i[o]}makeScripttable(n.length,scriptArray),makeArray(n.length,scriptArray)}function makeScripttable(e,t){document.getElementById("actor1_name").innerHTML="none",document.getElementById("actor1_first").innerHTML="none",document.getElementById("actor2_name").innerHTML="none",document.getElementById("actor2_first").innerHTML="none",document.getElementById("actor3_name").innerHTML="none",document.getElementById("actor3_first").innerHTML="none";for(var n=0;n<e;n++)0==t[n][0]&&(1==t[n][4]?(document.getElementById("actor1_name").innerHTML=t[n][1],document.getElementById("actor1_first").innerHTML=t[n][3]):2==t[n][4]?(document.getElementById("actor2_name").innerHTML=t[n][1],document.getElementById("actor2_first").innerHTML=t[n][3]):3==t[n][4]&&(document.getElementById("actor3_name").innerHTML=t[n][1],document.getElementById("actor3_first").innerHTML=t[n][3]))}function makeArray(e,t){var n="";n="",n='<table border=1 class="script"><tr class="ttitle"><th class="one">順番</th><th class="two">役者</th><th class="three">セリフ</th><th class="four">動き</th></tr>';for(var i=0;i<e;i++)for(var r=0;r<4;r++)0!=t[i][0]&&(0==r?(n+='<tr class="'+t[i][r]+'">',n+="<td>"+t[i][r]+"</td>"):n+=3==r?"<td>"+t[i][r]+"</td></tr>":"<td>"+t[i][r]+"</td>");n+="</table>",displayArray(n)}function displayArray(e){var t=document.getElementById("training_field");t.innerHTML=e}function judgeTraining(e){for(var t=0;t<scriptArray.length;t++)if(scriptArray[t][0]==count&&(e==scriptArray[t][4]&&(watching-=1,MessageChangeWhite()),"motion_ok"==e&&(kinecting-=1),console.log("判定する前！watching"+watching),0==watching&&0==kinecting)){console.log("ピンポンなんだ！"+count),NextNotification();break}DisplayCount(),document.getElementById("display_watching").innerHTML=watching,document.getElementById("display_kinecting").innerHTML=kinecting}function judgeMotionTraining(e){"motion_ok"==e&&(kinecting--,clearTimeout(timer),document.getElementById("check_kinect_text").innerHTML="Kinectチェック前",document.getElementById("check_kinect_text").style.backgroundColor="white"),document.getElementById("display_watching").innerHTML=watching,document.getElementById("display_kinecting").innerHTML=kinecting}function NextNotification(){clearTimeout(timer),RepairColor(),count+=1,AddColor(),MessageChangeRed(),SendInfo(),document.getElementById("display_watching").innerHTML=watching,document.getElementById("display_kinecting").innerHTML=kinecting,timer=setTimeout("SoundPlay()",7e3),DisplayCount()}function SendInfo(){for(var e=0;e<scriptArray.length;e++)scriptArray[e][0]==count&&(1==scriptArray[e][4]&&(0!=scriptArray[e][2]?(trainingsend(count,"Tablet1","training_send",scriptArray[e][1],scriptArray[e][2],scriptArray[e][3]),watching+=1):0==scriptArray[e][2]&&trainingsend(count,"Tablet1","training_send",scriptArray[e][1],"動きのみ",scriptArray[e][3])),2==scriptArray[e][4]&&(0!=scriptArray[e][2]?(trainingsend(count,"Tablet2","training_send",scriptArray[e][1],scriptArray[e][2],scriptArray[e][3]),watching+=1):0==scriptArray[e][2]&&trainingsend(count,"Tablet2","training_send",scriptArray[e][1],"動きのみ",scriptArray[e][3])),3==scriptArray[e][4]&&(0!=scriptArray[e][2]?(trainingsend(count,"Tablet3","training_send",scriptArray[e][1],scriptArray[e][2],scriptArray[e][3]),watching+=1):0==scriptArray[e][2]&&trainingsend(count,"Tablet3","training_send",scriptArray[e][1],"動きのみ",scriptArray[e][3])),0!=scriptArray[e][3]&&(motion_user=scriptArray[e][4],kinecting++),console.log("通知した！watching:"+watching+"  kinecting:"+kinecting))}function KinectCheck(e){clearTimeout(timer),count=e,document.getElementById("check_kinect_text").innerHTML="Kinectチェック中",document.getElementById("check_kinect_text").style.backgroundColor="red",AddColor(),MessageChangeRed(),SendToKinectInfo(),timer=setTimeout("SoundPlay()",7e3)}function SendToKinectInfo(){for(var e=0;e<scriptArray.length;e++)scriptArray[e][0]==count&&(motion_user=scriptArray[e][4],kinecting++)}function DisplayMessages(e,t){1==e&&(document.getElementById("watch_voice_reply1").innerHTML=t),2==e&&(document.getElementById("watch_voice_reply2").innerHTML=t),3==e&&(document.getElementById("watch_voice_reply3").innerHTML=t)}function MessageChangeWhite(){for(var e=0;e<scriptArray.length;e++)scriptArray[e][0]==count&&(1==scriptArray[e][4]&&(document.getElementById("watchvoicereply1").style.backgroundColor="white"),2==scriptArray[e][4]&&(document.getElementById("watchvoicereply2").style.backgroundColor="white"),3==scriptArray[e][4]&&(document.getElementById("watchvoicereply3").style.backgroundColor="white"))}function MessageChangeRed(){for(var e=0;e<scriptArray.length;e++)scriptArray[e][0]==count&&(1==scriptArray[e][4]&&(document.getElementById("watchvoicereply1").style.backgroundColor="red"),2==scriptArray[e][4]&&(document.getElementById("watchvoicereply2").style.backgroundColor="red"),3==scriptArray[e][4]&&(document.getElementById("watchvoicereply3").style.backgroundColor="red"))}function RepairColor(){for(var e=document.getElementsByClassName(count),t=0;t<e.length;t++)e[t].style.backgroundColor="#ffffff"}function AddColor(){for(var e=document.getElementsByClassName(count),t=0;t<e.length;t++)e[t].style.backgroundColor="#fffacd"}function SoundPlay(){var e=(new Audio("music/correct_sound.mp3"),new Audio("music/wrong_sound.mp3"));new Audio("music/drumroll_sound.mp3");0!=kinecting&&(e.play(),document.getElementById("check_kinect_text").innerHTML="Kinectチェック前",document.getElementById("check_kinect_text").style.backgroundColor="white"),DisplayCount()}function DisplayCount(){document.getElementById("training_count").innerHTML=count}var Classes=Object.create(null);exports.createConnection=function(e){var t=loadClass("Connection"),n=loadClass("ConnectionConfig");return new t({config:new n(e)})},exports.createPool=function(e){var t=loadClass("Pool"),n=loadClass("PoolConfig");return new t({config:new n(e)})},exports.createPoolCluster=function(e){var t=loadClass("PoolCluster");return new t(e)},exports.createQuery=function(e,t,n){var i=loadClass("Connection");return i.createQuery(e,t,n)},exports.escape=function(e,t,n){var i=loadClass("SqlString");return i.escape(e,t,n)},exports.escapeId=function(e,t){var n=loadClass("SqlString");return n.escapeId(e,t)},exports.format=function(e,t,n,i){var r=loadClass("SqlString");return r.format(e,t,n,i)},Object.defineProperty(exports,"Types",{get:loadClass.bind(null,"Types")}),define("node_modules/mysql/index",function(){});var host=location.origin.replace(/^http/,"ws"),ws=new WebSocket(host),userid=Math.floor(500*Math.random()),open_switch=0,num_dvc,doing=0,watching=0,kinecting=0,count=0,scriptArray,motion_user=0,timer=0,mysql=require(["node_modules/mysql/index"]);ws.onopen=function(){ws.send(JSON.stringify({user:userid,type:"connect",text:"open"}))},ws.onclose=function(e){console.log("クローズ"),ws.send(JSON.stringify({user:userid,type:"connect",text:"close"}))},window.onunload=function(e){ws.onclose("切断理由")},ws.onmessage=function(e){var t=JSON.parse(e.data);"ping"==t.type?write_ping(userid,t.text):"connect"==t.type?"open"==t.text?(0==open_switch&&(userid=t.user,open_switch=1,update_connect_status(),update_pc_status(userid)),write_log(t.user," device opened<br>")):"close"==t.text?write_log(t.user," device closed<br>"):"open_device"==t.text?"PC1"!=userid&&"PC2"!=userid&&"PC3"!=userid&&"Tablet1"!=userid&&"Tablet2"!=userid&&"Tablet3"!=userid&&("PC.1"==t.user?(write_log(t.user,":登録済み<br>"),update_pc1()):"PC.2"==t.user?(write_log(t.user,":登録済み<br>"),update_pc2()):"PC.3"==t.user?(write_log(t.user,":登録済み<br>"),update_pc3()):"TABLET.1"==t.user?(write_log(t.user,":登録済み<br>"),update_tablet1()):"TABLET.2"==t.user?(write_log(t.user,":登録済み<br>"),update_tablet2()):"TABLET.3"==t.user&&(write_log(t.user,":登録済み<br>"),update_tablet3())):"PC.1"==t.text?(write_log(t.user,":PC.1に登録完了<br>"),update_pc1(),t.user==userid&&(userid="PC1")):"PC.2"==t.text?(write_log(t.user,":PC.2に登録完了<br>"),update_pc2(),t.user==userid&&(userid="PC2")):"PC.3"==t.text?(write_log(t.user,":PC.3に登録完了<br>"),update_pc3(),t.user==userid&&(userid="PC3")):"TABLET.1"==t.text?(write_log(t.user,":TABLET.1に登録完了<br>"),update_tablet1(),t.user==userid&&(userid="Tablet1")):"TABLET.2"==t.text?(write_log(t.user,":TABLET.2に登録完了<br>"),update_tablet2(),t.user==userid&&(userid="Tablet2")):"TABLET.3"==t.text?(write_log(t.user,":TABLET.3に登録完了<br>"),update_tablet3(),t.user==userid&&(userid="Tablet3")):"KINECT"==t.user&&write_log(t.user," 接続完了"):"chat"==t.type?write_chat(t.user,t.text):"raise"==t.type||"training_prepare"==t.type||"training_send"==t.type||("training"==t.type?1==doing&&0!=watching&&(console.log("受信音声: 端末 "+t.user+" - メッセージ "+t.text),"Tablet1"==t.user?(judgeTraining(1),DisplayMessages(1,t.text)):"Tablet2"==t.user?(judgeTraining(2),DisplayMessages(2,t.text)):"Tablet3"==t.user&&(judgeTraining(3),DisplayMessages(3,t.text)),"please_stop"==t.text&&1==doing?onStopButton():"please_back_1"==t.text&&0==doing?onRestartBack1Button():"please_back_first"==t.text&&0==doing&&onStartButton()):"kinect_send"==t.type||("kinect"==t.type?(1==doing&&0!=kinecting?judgeTraining(t.text):0==doing&&0!=kinecting&&judgeMotionTraining(t.text),console.log("kinectからの受信: "+t.text)):console.log("その他のtypeを受信: "+t)))},define("indexc",function(){});